<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Certificate of Appreciation</title>
<style>
/* Keep your existing CSS */
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;
  background: linear-gradient(135deg, #667eea, #764ba2);
  display:flex;justify-content:center;align-items:center;
  min-height:100vh;padding:20px;
}
.page{max-width:1000px;width:100%;}
.title{font-weight:900;font-size:28px;text-align:center;margin-bottom:20px;color:white;}
.card{background:#fff;border-radius:16px;padding:20px;box-shadow:0 8px 20px rgba(0,0,0,0.15);}
.preview{margin-top:20px;position:relative;text-align:center;}
.preview img{max-width:100%;border-radius:12px;}
.name-overlay{position:absolute;top:57%;left:50%;transform:translate(-50%,0);
  font-size:36px;font-family:'Times New Roman',serif;font-weight:400;color:#222;}
.form{margin-top:20px;display:flex;flex-direction:column;gap:10px;}
input[type=text], input[type=file]{padding:12px;border-radius:8px;border:1px solid #ccc;width:100%;}
button{padding:12px;border:none;border-radius:8px;font-weight:600;cursor:pointer;color:white;background:#4e54c8;}
button:disabled{opacity:0.6;cursor:not-allowed;}
</style>
</head>
<body>
<div class="page">
  <div class="title">Certificate of Appreciation for Our PW Champs !!</div>
  <section class="card">
    
    <div class="preview" id="preview">
      <img src="certificate.jpg" alt="Certificate template" id="certImg">
      <div class="name-overlay" id="nameOverlay"></div>
    </div>

    <div class="form">
      <h3>Upload CSV (Name, Number)</h3>
      <input type="file" id="csvFile" accept=".csv" />

      <h3>Enter Phone Number</h3>
      <input id="phone" type="text" placeholder="Phone number" />

      <button id="download" disabled>Download Certificate</button>
      <button id="reset">Reset</button>
    </div>
  </section>
</div>

<!-- PapaParse for CSV parsing -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
const phoneInput = document.getElementById('phone');
const downloadBtn = document.getElementById('download');
const resetBtn = document.getElementById('reset');
const nameOverlay = document.getElementById('nameOverlay');
const certImg = document.getElementById('certImg');
const csvFile = document.getElementById('csvFile');

let phoneToName = {}; // mapping from Number -> Name

// Parse uploaded CSV
csvFile.addEventListener('change', (e)=>{
  const file = e.target.files[0];
  if(!file) return;
  Papa.parse(file, {
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      phoneToName = {};
      results.data.forEach(row => {
        if(row.Number && row.Name) {
          phoneToName[row.Number.trim()] = row.Name.trim();
        }
      });
      alert("CSV uploaded successfully with " + Object.keys(phoneToName).length + " entries.");
    }
  });
});

// Check phone number input
phoneInput.addEventListener('input', ()=>{
  const number = phoneInput.value.trim();
  const foundName = phoneToName[number];
  if(foundName){
    nameOverlay.textContent = foundName;
    downloadBtn.disabled = false;
  } else {
    nameOverlay.textContent = '';
    downloadBtn.disabled = true;
  }
});

// Reset everything
resetBtn.addEventListener('click', ()=>{
  phoneInput.value = '';
  nameOverlay.textContent = '';
  downloadBtn.disabled = true;
});

// Download certificate
downloadBtn.addEventListener('click', ()=>{
  if(!nameOverlay.textContent) return;

  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  const img = new Image();
  img.crossOrigin = 'anonymous';
  img.src = certImg.src;
  img.onload = ()=>{
    canvas.width = img.width;
    canvas.height = img.height;
    ctx.drawImage(img,0,0);
    ctx.font = '72px Times New Roman';
    ctx.fillStyle = '#222';
    ctx.textAlign = 'center';
    ctx.fillText(nameOverlay.textContent, canvas.width/2, canvas.height*0.65);

    const link = document.createElement('a');
    link.download = `${nameOverlay.textContent}_certificate.png`;
    link.href = canvas.toDataURL('image/png');
    link.click();
  };
});
</script>
</body>
</html>
