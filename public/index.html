<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Certificate of Appreciation</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%; font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;}
body{
  color:#222;
  background: linear-gradient(135deg, #667eea, #764ba2);
  overflow:hidden;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
}

.page{display:flex;flex-direction:column;align-items:center;padding:10px;width:100%;}
header{display:flex;align-items:center;justify-content:center;padding:12px 10px;width:100%;position:relative;}

.title{
  font-weight:900;
  font-size:clamp(28px, 8vw, 60px); 
  text-align:center;
  background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet);
  background-size: 400% 100%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: rainbow 8s linear infinite;
}
@keyframes rainbow {
  0%{background-position:0% 0%;}
  100%{background-position:400% 0%;}
}

.preview-btn {
  position:absolute;
  left:10px;
  top:10px;
  padding:10px 16px;
  background:#4e54c8;
  color:white;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:700;
  z-index:10;
}
.preview-btn:hover { background:#6f71f5; }

.hero{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;gap:20px;flex:1;overflow:hidden;}

.card{
  width: 100%;
  max-width: 1000px;
  background:#fff;
  border-radius:16px;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:16px;
  align-items:center;
  border: 6px solid transparent;
  border-image: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet) 1;
  animation: rainbowBorder 8s linear infinite;
  border-image-slice: 1;
  box-shadow:0 10px 30px rgba(75,0,130,0.08);
  position: relative;
}
@keyframes rainbowBorder {
  0%,100%{border-image: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet) 1;}
  25%{border-image: linear-gradient(180deg, red, orange, yellow, green, blue, indigo, violet) 1;}
  50%{border-image: linear-gradient(270deg, red, orange, yellow, green, blue, indigo, violet) 1;}
  75%{border-image: linear-gradient(360deg, red, orange, yellow, green, blue, indigo, violet) 1;}
}

/* Logos outside card */
.logo{
  position:absolute;
  width: clamp(40px,8vw,80px);
  height: clamp(40px,8vw,80px);
  object-fit: contain;
  z-index:1;
}
.top-left{top:10px; left:10px;}
.top-right{top:10px; right:10px;}
.bottom-left{bottom:10px; left:10px;}
.bottom-right{bottom:10px; right:10px;}

.headline{
  font-size: clamp(16px, 4vw, 28px);
  color:#4B0082;
  font-weight:800;
  text-align:center;
}
.sub{margin-top:5px;color:#444;opacity:.9;}

.preview{
  margin-top:10px;
  background:#fff;
  border-radius:12px;
  overflow:hidden;
  position:relative;
  border:2px solid #4B0082;
  box-shadow:0 4px 14px rgba(0,0,0,0.08);
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  max-height:450px;
  max-width:100%;
  width:auto;
}
.preview img{
  max-width:75%;
  max-height:100%;
  height:auto;
  display:block;
}

.name-overlay{
  position:absolute;
  top:57%;
  left:50%;
  transform:translate(-50%, 0);
  font-size: clamp(18px, 4vw, 36px);
  font-weight:400;
  color:#222;
  text-align:center;
  white-space:nowrap;
  font-family:'Times New Roman',serif;
  letter-spacing:1px;
  z-index:2;
}

.form{background:linear-gradient(180deg,#fff,#fbfbff);padding:18px;border-radius:12px;border:1px solid rgba(75,0,130,0.06);display:flex;flex-direction:column;align-items:center;gap:12px;margin-top:10px;width:100%;}
.form h2{color:#333;margin-bottom:4px;font-size:clamp(18px, 4vw, 24px);}
.name-input{width:100%;display:flex;gap:8px;flex-wrap:wrap;}
input[type=text]{flex:1;padding:12px;border-radius:10px;border:1px solid #e6e6f2;font-size:clamp(14px, 3vw,16px);min-width:0;}

.btn-rainbow{
  padding:12px 20px;
  border-radius:12px;
  font-weight:700;
  font-size:clamp(14px, 3vw,16px);
  border:none;
  cursor:pointer;
  background: linear-gradient(90deg, #4e54c8, #8f94fb);
  position: relative;
  color: white;
  overflow: hidden;
  box-shadow:0 6px 20px rgba(0,0,0,0.2);
  transition: transform 0.2s;
  flex:1;
  min-width:120px;
}
.btn-rainbow::before{
  content:'';
  position:absolute;
  top:0; left:0; width:100%; height:100%;
  background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet);
  background-size: 400% 100%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: rainbow 8s linear infinite;
  mix-blend-mode: screen;
}
.btn-rainbow:disabled{
  opacity:0.6;
  cursor:not-allowed;
}
.btn-rainbow:hover:enabled{transform: scale(1.05);}

@media (max-width:1024px){
  .card{padding:16px;}
  .form{padding:12px;}
  .preview{max-height:300px;}
}
</style>
</head>
<body>
<div class="page">
<header>
  <button class="preview-btn" id="previewBtn">Preview Certificate</button>
  <div class="title">Certificate of Appreciation for Our PW Champs !!</div>
</header>

<!-- Logos outside card -->
<img src="logo1.svg" class="logo top-left" alt="Top Left Logo">
<img src="logo2.svg" class="logo top-right" alt="Top Right Logo">
<img src="logo3.svg" class="logo bottom-left" alt="Bottom Left Logo">
<img src="logo4.svg" class="logo bottom-right" alt="Bottom Right Logo">

<main class="hero">
  <section class="card" role="region" aria-label="Main">
    <div style="width:100%;">
      <div class="headline">A simple token of appreciation â€” fast, printable, and beautiful.</div>
      
      <div class="preview" id="preview">
        <img src="certificate.jpg" alt="Certificate template" id="certImg">
        <div class="name-overlay" id="nameOverlay"></div>
      </div>
    </div>

    <aside class="form" aria-label="Create">
      <h2>Enter Your Name Below</h2>
      <div class="name-input">
        <input id="name" type="text" placeholder="Full name" value="" />
      </div>
      
      <div style="width:100%;display:flex;gap:12px;justify-content:center;margin-top:12px;flex-wrap:wrap">
        <button id="download" class="btn-rainbow" disabled>Download Certificate</button>
        <button id="reset" class="btn-rainbow">Reset</button>
      </div>
    </aside>
  </section>
</main>
</div>

<script>
const nameInput = document.getElementById('name');
const download = document.getElementById('download');
const reset = document.getElementById('reset');
const nameOverlay = document.getElementById('nameOverlay');
const certImg = document.getElementById('certImg');
const previewBtn = document.getElementById('previewBtn');

// Update name overlay and enable download
nameInput.addEventListener('input', ()=>{
  const val = nameInput.value.trim();
  nameOverlay.textContent = val || '';
  download.disabled = val === '';
});

// Reset form
reset.addEventListener('click', ()=>{
  nameInput.value = '';
  nameOverlay.textContent = '';
  download.disabled = true;
});

// Download certificate and notify backend API
download.addEventListener('click', async ()=>{
  if(!nameInput.value.trim()) return;

  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  const img = new Image();
  img.crossOrigin = 'anonymous';
  img.src = certImg.src;
  img.onload = async ()=>{
    canvas.width = img.width;
    canvas.height = img.height;
    ctx.drawImage(img,0,0);
    ctx.font = '72px Times New Roman';
    ctx.fillStyle = '#222';
    ctx.textAlign = 'center';
    ctx.fillText(nameOverlay.textContent, canvas.width/2, canvas.height*0.65);

    // Save as PNG
    const link = document.createElement('a');
    link.download = 'certificate.png';
    link.href = canvas.toDataURL('image/png');
    link.click();

    // Notify backend API
    try {
      await fetch('/api/download-count', { method:'POST' });
    } catch(err){ console.error('Count API error:', err); }
  };
});

// Preview certificate in popup
previewBtn.addEventListener('click', ()=>{
  const previewWindow = window.open('', 'Preview Certificate', 'width=900,height=600');
  previewWindow.document.write('<html><head><title>Certificate Preview</title></head><body style="margin:0;display:flex;justify-content:center;align-items:center;height:100vh;position:relative;">');
  
  const cloneImg = certImg.cloneNode();
  cloneImg.style.maxWidth = '90%';
  cloneImg.style.height = 'auto';
  previewWindow.document.body.appendChild(cloneImg);
  
  const overlayDiv = previewWindow.document.createElement('div');
  overlayDiv.innerText = nameOverlay.textContent || '';
  overlayDiv.style.position='absolute';
  overlayDiv.style.top='57%';
  overlayDiv.style.left='50%';
  overlayDiv.style.transform='translate(-50%,0)';
  overlayDiv.style.fontFamily='Times New Roman';
  overlayDiv.style.fontSize='36px';
  overlayDiv.style.color='#222';
  overlayDiv.style.fontWeight='400';
  previewWindow.document.body.appendChild(overlayDiv);

  previewWindow.document.write('</body></html>');
});
</script>
</body>
</html>
